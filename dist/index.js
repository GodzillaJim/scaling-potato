(()=>{"use strict";var e={752:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(r(582)),a=n(r(142)),i=n(r(860)),u=n(r(806)),s=n(r(470)),l=r(528),c=n(r(479));a.default.config();var f=(0,i.default)(),d=[(0,s.default)(l.morganConfig),(0,u.default)(),(0,o.default)(l.corsOptionsWhiteList),i.default.json(),i.default.urlencoded({extended:!1})];f.use(d),f.use("/api/v1",c.default),t.default=f},528:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.morganConfig=t.corsOptionsWhiteList=void 0;var o=n(r(588)),a={allowedHeaders:["Origin","X-Requested-With","Content-Type","Accept","X-Access-Token","Authorization"],credentials:!0,methods:"GET,HEAD,OPTIONS,PUT,PATCH,POST,DELETE",preflightContinue:!1};t.corsOptionsWhiteList=function(e,t){var r=e.header("origin")?e.header("origin"):e.header("host");if(r&&["localhost:4200","localhost:3000","localhost:5000"].some((function(e){return r.includes(e)})))return a.origin=!0,void t(null,a);a.origin=!1,t(new Error("Origin not allowed by CORS: ".concat(r)),a)},t.morganConfig=function(e,t,r){var n=[e.method(t,r),e.url(t,r),"-","statusCode:",e.status(t,r),"-","response-size:",e.res(t,r,"content-length"),"-","response-time:",e["response-time"](t,r),"ms"].join(" ");return o.default.info(n),n}},275:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),n(r(142)).default.config(),t.default={mailer:{host:process.env.MAIL_HOST,port:parseInt(process.env.MAIL_PORT,10),auth:{user:process.env.MAIL_USERNAME,pass:process.env.MAIL_PASSWORD}},kafka:{bootstrapServerHost:process.env.KAFKA_BOOTSTRAP_SERVER||"localhost:9092",port:process.env.KAFKA_PORT||9092,clientId:process.env.KAFKA_CLIENT_ID},jwt:{secret:process.env.JWT_SECRET||"SECRET",expiration:process.env.JWT_EXPIRATION||3e3}}},588:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var n=r(773),o=(0,n.createLogger)({level:"info",format:n.format.combine(n.format.simple(),n.format.timestamp(),n.format.printf((function(e){return"[".concat(e.timestamp,"] ").concat(e.level,": ").concat(e.message)}))),defaultMeta:{service:"user-service"},transports:[new n.transports.File({filename:"./logs/error.log",level:"error"}),new n.transports.File({filename:"./logs/info.log",level:"info"})]});t.default=o},894:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(142),a=n(r(588)),i=n(r(185)),u=function(){function e(){(0,o.config)()}return e.prototype.connect=function(){i.default.connect(process.env.MONGO_DB,{servername:"COLLABOR@TOR"}).then((function(){a.default.info("MongoDb connected")})).catch((function(e){a.default.error(e)}))},e}();t.default=u},354:function(e,t,r){var n=this&&this.__decorate||function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var u=e.length-1;u>=0;u--)(o=e[u])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},o=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,a){function i(e){try{s(n.next(e))}catch(e){a(e)}}function u(e){try{s(n.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,u)}s((n=n.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var u=r(934),s=i(r(548)),l=function(){function e(){this.accountService=new s.default}return e.prototype.registerNewUser=function(e,t,r){return o(this,void 0,void 0,(function(){var n,o;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),n=e.body,[4,this.accountService.registerNewAccount(n)];case 1:return a.sent(),t.status(200).json({success:!0,data:"Check email to continue"}),[3,3];case 2:return o=a.sent(),r(o),[3,3];case 3:return[2]}}))}))},e.prototype.loginUser=function(e,t,r){return o(this,void 0,void 0,(function(){var n,o,i;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),n=e.body,[4,this.accountService.loginUser(n)];case 1:return o=a.sent(),t.status(200).json(o),[3,3];case 2:return i=a.sent(),r(i),[3,3];case 3:return[2]}}))}))},n([u.boundClass],e)}();t.default=l},978:function(e,t,r){var n=this&&this.__decorate||function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var u=e.length-1;u>=0;u--)(o=e[u])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},o=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,a){function i(e){try{s(n.next(e))}catch(e){a(e)}}function u(e){try{s(n.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,u)}s((n=n.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var u=r(934),s=i(r(588)),l=i(r(743)),c=function(){function e(){this.name="Contact-Form-Controller",this.contactService=new l.default}return e.prototype.sendContactFormSubmission=function(e,t,r){return o(this,void 0,void 0,(function(){var t,n;return a(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),t=e.body,[4,this.contactService.submitContactForm(t)];case 1:return o.sent(),s.default.info(t),[3,3];case 2:return n=o.sent(),s.default.error(n),r(n),[3,3];case 3:return[2]}}))}))},n([u.boundClass],e)}();t.default=c},890:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,a){function i(e){try{s(n.next(e))}catch(e){a(e)}}function u(e){try{s(n.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,u)}s((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=a(r(542)),u=a(r(37)),s=function(){function e(){}return e.getUsers=function(e,t){return n(this,void 0,void 0,(function(){var e,r;return o(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,i.default.getAllUsers()];case 1:return e=n.sent(),[2,t.json(e)];case 2:return r=n.sent(),[2,t.json((0,u.default)(r))];case 3:return[2]}}))}))},e}();t.default=s},37:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(r(931));t.default=function(e,t){switch(void 0===t&&(t=500),t){case 404:return new o.default.NotFound(e.message);case 400:return new o.default.BadRequest(e.message);case 401:return new o.default.Unauthorized(e.message);case 403:return new o.default.Forbidden(e.message);default:return{error:{statusCode:t,message:e.message}}}}},607:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,a){function i(e){try{s(n.next(e))}catch(e){a(e)}}function u(e){try{s(n.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,u)}s((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(142),u=a(r(773)),s=a(r(894)),l=a(r(752)),c=r(485);(0,i.config)();var f=process.env.PORT||3e3;(new s.default).connect(),l.default.listen(f,(function(){return n(void 0,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return u.default.info("connected to port ".concat(f)),console.log("connected to port ".concat(f)),[4,(0,c.seedRoles)()];case 1:return e.sent(),[4,(0,c.seedAdmin)()];case 2:return e.sent(),[2]}}))}))}))},936:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,a){function i(e){try{s(n.next(e))}catch(e){a(e)}}function u(e){try{s(n.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,u)}s((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(517),u=r(158),s=a(r(823)),l=a(r(588)),c=a(r(37)),f=u.constants.HTTP_STATUS_UNAUTHORIZED,d=function(){function e(){this.authService=new s.default}return e.isAuthenticated=function(e,t,r){return n(this,void 0,void 0,(function(){var n,a,u,l,d,p;return o(this,(function(o){try{return!(n=e.header("Authorization"))&&(0,i.isEmpty)(n)||!(a=s.default.verifyToken(n.split(" ")[1]))?[2,t.status(f).json((0,c.default)({message:"Please provide a valid token on header"},f))]:(u=a.payload,l=u.email,d=u.firstName,p=u.roles,t.locals={user:{email:l,firstName:d,roles:p}},[2,r()])}catch(e){return[2,t.status(500).json((0,c.default)(e))]}return[2]}))}))},e.checkAuthorization=function(e,t){try{if(t.find((function(t){return console.log("Comparison: ",t,e.toString()),"".concat(t)===e.toString()})))return!0}catch(e){l.default.error(e)}return!1},e.isAuthorized=function(t){return function(r,n,o){try{var a=n.locals.user.roles;return e.checkAuthorization(t,a)?o():n.status(403).json((0,c.default)({message:"Unauthorized"},403))}catch(e){return l.default.error(e),n.status(500).json((0,c.default)(e,500))}}},e}();t.default=d},797:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.mainLimiter=void 0;var o=n(r(985));t.mainLimiter=(0,o.default)({windowMs:6e5,max:100,message:{status:429,message:"Too Many Requests"}})},554:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Role=t.User=void 0;var o=n(r(313)),a=n(r(793));t.User=a.default,t.Role=o.default},313:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RoleSchema=void 0;var o=n(r(185)),a=r(230);t.RoleSchema=new o.default.Schema({name:{type:String,enum:a.Role,default:a.Role.END_USER},createdBy:String},{timestamps:!0}),t.default=o.default.model("Role",t.RoleSchema)},793:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var n=r(185),o=new n.Schema({email:{type:String,unique:!0,required:!0},firstName:{type:String,required:!0},lastName:{type:String,required:!0},password:{type:String,required:!0},disabled:{type:Boolean,default:!0},verified:{type:Boolean,default:!1},emailVerifiedAt:{type:Date,default:void 0},emailVerificationCode:String,imageUrl:String,salt:String,roles:{type:Array,default:[]}});t.default=(0,n.model)("User",o)},630:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(r(860)),a=r(797),i=n(r(354)),u=n(r(661)),s=n(r(15)),l=n(r(5)),c=o.default.Router(),f=new i.default;c.route("/register").post([a.mainLimiter,u.default.validateInput(s.default),f.registerNewUser]),c.route("/login").post([a.mainLimiter,u.default.validateInput(l.default),f.loginUser]),t.default=c},307:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(860),a=n(r(661)),i=n(r(830)),u=n(r(978)),s=(0,o.Router)(),l=new u.default;s.route("/contact").get((function(e,t){t.json({status:"Route is live",url:e.url})})).post([a.default.validateInput(i.default),l.sendContactFormSubmission]),t.default=s},479:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(860),a=n(r(630)),i=n(r(400)),u=n(r(307)),s=(0,o.Router)();s.use("/auth",a.default),s.use("/user",i.default),s.use("/guest",u.default),t.default=s},400:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(r(860)),a=r(797),i=n(r(936)),u=r(230),s=n(r(890)),l=o.default.Router();l.route("/").get([a.mainLimiter,i.default.isAuthenticated,i.default.isAuthorized(u.Role.END_USER),i.default.isAuthorized(u.Role.ADMIN),s.default.getUsers]),t.default=l},485:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,a){function i(e){try{s(n.next(e))}catch(e){a(e)}}function u(e){try{s(n.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,u)}s((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.seedAdmin=t.seedRoles=void 0;var i=r(935),u=r(554),s=a(r(588)),l=a(r(823)),c=r(230),f=[c.Role.ADMIN,c.Role.END_USER,c.Role.SUPER_ADMIN],d=new l.default;t.seedRoles=function(){return n(void 0,void 0,void 0,(function(){var e,t;return o(this,(function(r){switch(r.label){case 0:return r.trys.push([0,4,,5]),[4,u.Role.find({})];case 1:return 0!==r.sent().length?[3,3]:(e=f.map((function(e){var t=new u.Role;return t.name=e.toString(),t.createdBy="GodzillaJim",t})),[4,u.Role.bulkSave(e)]);case 2:r.sent(),r.label=3;case 3:return[3,5];case 4:return t=r.sent(),s.default.error(t),[3,5];case 5:return[2]}}))}))},t.seedAdmin=function(){return n(void 0,void 0,void 0,(function(){var e,t,r,n,a,l;return o(this,(function(o){switch(o.label){case 0:return o.trys.push([0,5,,6]),[4,u.User.findOne({email:"superadmin@collaborate.com"})];case 1:return o.sent()?[3,4]:(e=new u.User,t=d.encryptPassword("password123"),r=t.salt,n=t.hash,e.email="superadmin@collaborate.com",e.firstName=i.faker.name.firstName(),e.lastName=i.faker.name.lastName(),e.password=n,e.salt=r,e.imageUrl=i.faker.image.avatar(),e.disabled=!1,e.verified=!0,e.emailVerifiedAt=new Date,e.emailVerificationCode=i.faker.word.noun(6),a=e,[4,u.Role.find({})]);case 2:return a.roles=o.sent(),[4,e.save()];case 3:o.sent(),o.label=4;case 4:return[3,6];case 5:return l=o.sent(),s.default.error(l),[3,6];case 6:return[2]}}))}))}},542:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,a){function i(e){try{s(n.next(e))}catch(e){a(e)}}function u(e){try{s(n.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,u)}s((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=a(r(793)),u=function(){function e(){}return e.getAllUsers=function(){return n(this,void 0,void 0,(function(){return o(this,(function(e){return[2,i.default.find()]}))}))},e}();t.default=u},548:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,a){function i(e){try{s(n.next(e))}catch(e){a(e)}}function u(e){try{s(n.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,u)}s((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=a(r(931)),u=r(554),s=a(r(823)),l=function(){function e(){this.authService=new s.default}return e.prototype.registerNewAccount=function(e){return n(this,void 0,void 0,(function(){var t,r,n,a,s;return o(this,(function(o){switch(o.label){case 0:return[4,u.User.findOne({email:e.email})];case 1:if(o.sent())throw new i.default.BadRequest("This email is already registered.");return t=this.authService.encryptPassword(e.password),r=t.salt,n=t.hash,(a=new u.User).email=e.email,a.firstName=e.firstName,a.lastName=e.lastName,a.password=n,a.salt=r,s=a,[4,this.authService.getDefaultRoles()];case 2:return s.roles=o.sent(),[4,a.save()];case 3:return o.sent(),[2,{success:!0,message:"Account created successfully!"}]}}))}))},e.prototype.loginUser=function(e){var t=e.email,r=e.password;return n(this,void 0,void 0,(function(){var e,n;return o(this,(function(o){switch(o.label){case 0:return[4,u.User.findOne({email:t})];case 1:if(!(e=o.sent()))throw(n=new i.default.BadRequest("This person does not exist!")).status=400,n;if(!this.authService.validatePassword(r,e.password,e.salt))throw(n=new i.default.BadRequest("Wrong username or password!")).status=400,n;return console.log("Accounts.User.Roles",e.roles),[2,this.authService.generateJwtToken({email:t,firstName:e.firstName,roles:e.roles.map((function(e){return e.name}))})]}}))}))},e}();t.default=l},823:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,a){function i(e){try{s(n.next(e))}catch(e){a(e)}}function u(e){try{s(n.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,u)}s((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=a(r(113)),u=r(517),s=a(r(344)),l=a(r(275)),c=a(r(313)),f=function(){function e(){this.salt=i.default.randomBytes(16).toString("hex"),this.defaultRole=["endUser"],this.secret=l.default.jwt.secret,this.expiration=l.default.jwt.expiration}return e.verifyToken=function(e){try{return s.default.verify(e,l.default.jwt.secret,{complete:!0})}catch(e){return console.log(e),null}},e.prototype.getDefaultRoles=function(){return n(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,c.default.find({name:this.defaultRole})];case 1:return[2,e.sent()]}}))}))},e.prototype.encryptPassword=function(e){var t=i.default.pbkdf2Sync(e,this.salt,1e3,64,"sha1").toString("hex");return{salt:this.salt,hash:t}},e.prototype.validatePassword=function(e,t,r){var n=i.default.pbkdf2Sync(e,r,1e3,64,"sha1").toString("hex");return(0,u.isEqual)(n,t)},e.prototype.generateJwtToken=function(e){var t=e.email,r=e.firstName,n=e.roles;return{token:s.default.sign({email:t,firstName:r,roles:n},this.secret,{expiresIn:this.expiration}),expiresIn:this.expiration}},e}();t.default=f},743:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,a){function i(e){try{s(n.next(e))}catch(e){a(e)}}function u(e){try{s(n.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,u)}s((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=a(r(588)),u=a(r(73)),s=function(){function e(){this.TOPIC="collaborate_contact_form_messages"}return e.prototype.submitContactForm=function(e){return n(this,void 0,void 0,(function(){var t;return o(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,(new u.default).produceMessage(this.TOPIC,e)];case 1:return r.sent(),[3,3];case 2:return t=r.sent(),i.default.error(t),[3,3];case 3:return[2]}}))}))},e}();t.default=s},73:function(e,t,r){var n=this&&this.__decorate||function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var u=e.length-1;u>=0;u--)(o=e[u])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},o=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,a){function i(e){try{s(n.next(e))}catch(e){a(e)}}function u(e){try{s(n.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,u)}s((n=n.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var u=r(934),s=i(r(588)),l=r(876),c=function(){function e(){this.producer=l.producer}return e.prototype.produceMessage=function(e,t){return o(this,void 0,void 0,(function(){var r;return a(this,(function(n){switch(n.label){case 0:return n.trys.push([0,3,,4]),[4,this.producer.connect()];case 1:return n.sent(),[4,this.producer.send({topic:e,messages:[{value:JSON.stringify(t)}]})];case 2:return n.sent(),[3,4];case 3:return r=n.sent(),s.default.error(r),[3,4];case 4:return[2]}}))}))},n([u.boundClass],e)}();t.default=c},876:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.consumer=t.producer=void 0;var o=r(543),a=n(r(142)),i=n(r(275));a.default.config();var u=i.default.kafka,s=u.clientId,l=u.bootstrapServerHost,c=new o.Kafka({clientId:s,brokers:[l]});t.producer=c.producer(),t.consumer=c.consumer({groupId:"collabor@te"}),t.default=c},661:function(e,t,r){var n=this&&this.__decorate||function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var u=e.length-1;u>=0;u--)(o=e[u])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var a=r(517),i=r(934),u=r(136),s=r(849),l=o(r(588)),c=function(){function e(){}return e.validateForm=function(e){var t=e.name&&e.email&&e.message&&e.subject,r=(0,a.isEmpty)(e)||(0,a.isEmpty)(e.name)||(0,a.isEmpty)(e.message)||(0,a.isEmpty)(e.subject)||(0,a.isEmpty)(e.email);return!(!Boolean(t)||r)},e.validateInput=function(e){return function(t,r,n){var o=(0,u.plainToInstance)(e,t.body);(0,s.validate)(o,t.body,{skipMissingProperties:!0,stopAtFirstError:!0}).then((function(e){if(e.length>0){l.default.error(e);var a=[];return e.forEach((function(e){a.push(e.constraints)})),r.status(400).json({error:!0,data:a})}return t.body=o,n()}))}},n([i.boundClass],e)}();t.default=c},830:function(e,t,r){var n=this&&this.__decorate||function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var u=e.length-1;u>=0;u--)(o=e[u])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i};Object.defineProperty(t,"__esModule",{value:!0});var o=r(849),a=function(){function e(e,t,r,n){this.email=e,this.name=t,this.subject=r,this.message=n}return n([(0,o.IsEmail)(),(0,o.IsNotEmpty)()],e.prototype,"email",void 0),n([(0,o.IsNotEmpty)()],e.prototype,"name",void 0),n([(0,o.IsNotEmpty)()],e.prototype,"subject",void 0),n([(0,o.IsNotEmpty)()],e.prototype,"message",void 0),e}();t.default=a},5:function(e,t,r){var n=this&&this.__decorate||function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var u=e.length-1;u>=0;u--)(o=e[u])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i};Object.defineProperty(t,"__esModule",{value:!0});var o=r(849),a=function(){function e(){}return n([(0,o.IsNotEmpty)(),(0,o.IsEmail)()],e.prototype,"email",void 0),n([(0,o.IsNotEmpty)()],e.prototype,"password",void 0),e}();t.default=a},15:function(e,t,r){var n=this&&this.__decorate||function(e,t,r,n){var o,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var u=e.length-1;u>=0;u--)(o=e[u])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i};Object.defineProperty(t,"__esModule",{value:!0});var o=r(849),a=function(){function e(){}return n([(0,o.IsNotEmpty)()],e.prototype,"firstName",void 0),n([(0,o.IsNotEmpty)()],e.prototype,"lastName",void 0),n([(0,o.IsNotEmpty)(),(0,o.IsEmail)()],e.prototype,"email",void 0),n([(0,o.IsNotEmpty)()],e.prototype,"password",void 0),e}();t.default=a},230:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.Role=void 0,(r=t.Role||(t.Role={}))[r.END_USER=0]="END_USER",r[r.ADMIN=1]="ADMIN",r[r.SUPER_ADMIN=2]="SUPER_ADMIN"},935:e=>{e.exports=require("@faker-js/faker")},934:e=>{e.exports=require("autobind-decorator")},136:e=>{e.exports=require("class-transformer")},849:e=>{e.exports=require("class-validator")},582:e=>{e.exports=require("cors")},142:e=>{e.exports=require("dotenv")},860:e=>{e.exports=require("express")},985:e=>{e.exports=require("express-rate-limit")},806:e=>{e.exports=require("helmet")},931:e=>{e.exports=require("http-errors")},344:e=>{e.exports=require("jsonwebtoken")},543:e=>{e.exports=require("kafkajs")},517:e=>{e.exports=require("lodash")},185:e=>{e.exports=require("mongoose")},470:e=>{e.exports=require("morgan")},773:e=>{e.exports=require("winston")},113:e=>{e.exports=require("crypto")},158:e=>{e.exports=require("http2")}},t={};!function r(n){var o=t[n];if(void 0!==o)return o.exports;var a=t[n]={exports:{}};return e[n].call(a.exports,a,a.exports,r),a.exports}(607)})();
//# sourceMappingURL=index.js.map